<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Appointments</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="icon" href="Assets/sl.png" type="image/png"> 
  
  <style>
        /* Centered text */
        .navbar-brand {
            display: inline-block;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .navbar-brand span {
            display: block;
            font-size: 40px;
            font-weight: normal;
            color: #777;
        }

        .navbar-brand {
            font-size: 2rem;

            font-weight: bold;
        }

        .navbar-brand span {
            display: block;
            font-size: 1.2rem;

            font-weight: normal;
            color: #999;

        }


        .icon {
            font-size: 24px;
            color: #007bff;
        }

        .con {
            margin: 0;
            font-size: 14px;
            color: #333;
        }

        .hr {
            margin: 0;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .time {
            margin: 0;
            font-size: 14px;
            color: #777;
        }

        .d-flex {
            display: flex;
            align-items: center;
        }


        .bg-blue {
            background-color: #007bff !important;
            /* Bootstrap primary blue color */
        }

        .navbar-dark .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.8);
            transition: margin 0.3s ease-in-out, color 0.3s ease-in-out, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, text-shadow 0.3s ease-in-out;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
            /* Add text-shadow for a subtle glow effect */
        }

        .navbar-dark .navbar-nav .nav-link:hover,
        .navbar-dark .navbar-nav .nav-link:focus {
            color: rgba(255, 255, 255, 1);
            margin-left: 15px;
            margin-right: 15px;
            transform: scale(1.1);


            text-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
            /* Enhance text with a glow effect */
        }

        /* Adjusted styles for nav items */
        .navbar-nav {

            text-transform: uppercase;
            text-align: center;
            font-weight: 600;
        }

        .navbar-nav * {
            box-sizing: border-box;
            transition: all .35s ease;
        }

        .nav-item {
            display: inline-block;
            list-style: outside none none;
            margin: .5em 1em;
            padding: 0;
        }

        .nav-link {
            padding: .5em .8em;
            color: rgba(255, 255, 255, 0.5) !important;
            position: relative;
            text-decoration: none;
            font-size: 20px;
        }

        .nav-link::before,
        .nav-link::after {
            content: '';
            height: 14px;
            width: 14px;
            position: absolute;
            transition: all .35s ease;
            opacity: 0;
        }

        .nav-link::before {
            content: '';
            right: 0;
            top: 0;
            border-top: 3px solid #ffffff;
            border-right: 3px solid #ffffff;
            transform: translate(-100%, 50%);
        }

        .nav-link::after {
            content: '';
            left: 0;
            bottom: 0;
            border-bottom: 3px solid #ffffff;
            border-left: 3px solid #ffffff;
            transform: translate(100%, -50%);
        }

        .nav-link:hover::before,
        .nav-link:hover::after {
            transform: translate(0, 0);
            opacity: 1;
        }

        .nav-link:hover {
            color: #ffffff !important;
        }

        .highlight {
            font-weight: bold;
            color: #007bff;
            /* You can adjust the color as needed */


        }
    </style>


</head>
<body>
    <div class="py-md-5 py-4 border-bottom">
        <div class="container">
            <div class="row no-gutters d-flex align-items-start align-items-center px-3 px-md-0">
                <div class="col-md-4 d-flex topper mb-md-0 mb-2 align-items-center justify-content-start text-md-left">
                    <div class="icon d-flex justify-content-center align-items-center order-md-last">
                        <span class="icon-map"></span>
                    </div>
                    <div class="pr-md-4 pl-md-0 pl-3 text">
                        <p class="con"><span class="highlight">Call Us : </span> <i class="fa fa-light fa-phone fa-fade"></i></i><span>+1 234 456 78910</span></p>
                        <p class="con"><span class="highlight">Location: </span> </i> 80 Jorissen St, Braamfontein, Johannesburg</p>
                    </div>
                </div>
                <div class="col-md-4 d-flex align-items-center justify-content-center text-center">
                    <a class="navbar-brand" href="index.html">Braamfontein<span>Dentist Clinic</span></a>
                </div>
                <div class="col-md-4 d-flex topper mb-md-0 mb-2 align-items-center justify-content-end">
                    <div class="icon d-flex justify-content-center align-items-center"><span class="icon-paper-plane"></span></div>
                    <div class="text pl-3 pl-md-3">
                        <p class="hr"><span class="highlight">Open Hours</span></p>
                        <p class="time"><span class="highlight">Mon - Fri:</span> <span class="highlight">8:00am - 5:00pm</span> Sun: Closed</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-blue ftco-navbar-light" id="ftco-navbar">
        <div class="container d-flex align-items-center">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
            </button>
            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav m-auto">
                    <li class="nav-item active"><a href="home.html" class="nav-link pl-0">Appointment</a></li>
                    <li class="nav-item"><a href="upcomingAppointments.html" class="nav-link">Manage Appointments</a></li>
                    <li class="nav-item"><a href="educationalContent.html" class="nav-link">Educational Content</a></li>
                </ul>
            </div>
        </div>
    </nav>

    
    <div class="container mt-4">
        <h1 id="msg"></h1>
        <div class="d-flex justify-content-between align-items-center">
            <h2 id="greet"></h2>
            <button id="signOutBtn" class="btn btn-danger mt-3">Sign Out</button>
        </div>
        <h3 class="mt-4">Upcoming Appointments</h3>
        <div class="table-responsive mt-3">
            <table class="table table-bordered" id="appointmentsTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Appointments will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALiVOPNJmuTJUl5XgOuYBQ14ZqcPw-DwQ",
            authDomain: "malevolentmotion.firebaseapp.com",
            databaseURL: "https://malevolentmotion-default-rtdb.firebaseio.com",
            projectId: "malevolentmotion",
            storageBucket: "malevolentmotion.appspot.com",
            messagingSenderId: "243036520479",
            appId: "1:243036520479:web:c767364f1ded2f96b4952a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));

        let MsgHead = document.getElementById('msg');
        let GreetHead = document.getElementById('greet');
        let SignOutBtn = document.getElementById('signOutBtn');
        let AppointmentsTable = document.getElementById('appointmentsTable').getElementsByTagName('tbody')[0];

        let SignOut = () => {
            signOut(auth).then(() => {
                sessionStorage.removeItem("user-creds");
                sessionStorage.removeItem("user-info");
                window.location.href = 'login.html';
            }).catch((error) => {
                console.error('Sign out error:', error);
            });
        }

        let CheckCred = () => {
            if (!UserCreds) {
                window.location.href = 'login.html';
            } else {
                MsgHead.innerText = `User with email ${UserCreds.email} logged in`;
                GreetHead.innerText = `Welcome ${UserInfo.firstname} ${UserInfo.lastname}`;
            }
        }

        let fetchUpcomingAppointments = async () => {
            try {
                console.log('Fetching upcoming appointments...');
                const bookingsRef = ref(db, 'bookings');
                const bookingQuery = query(bookingsRef, orderByChild('userId'), equalTo(UserCreds.uid));
                const bookingSnapshot = await get(bookingQuery);

                AppointmentsTable.innerHTML = '';

                if (bookingSnapshot.exists()) {
                    bookingSnapshot.forEach(childSnapshot => {
                        let booking = childSnapshot.val();
                        let row = AppointmentsTable.insertRow();
                        row.insertCell(0).innerText = booking.date;
                        row.insertCell(1).innerText = booking.startTime;
                        row.insertCell(2).innerText = booking.endTime;
                        row.insertCell(3).innerText = booking.type;
                    });
                } else {
                    console.log('No upcoming appointments found.');
                    let row = AppointmentsTable.insertRow();
                    let cell = row.insertCell(0);
                    cell.colSpan = 4;
                    cell.innerText = 'No upcoming appointments';
                    cell.className = 'text-center';
                }
            } catch (error) {
                console.error('Error fetching appointments:', error);
            }
        }

        window.addEventListener('load', () => {
            CheckCred();
            fetchUpcomingAppointments();
        });

        SignOutBtn.addEventListener('click', SignOut);
    </script>
</body>
</html>
